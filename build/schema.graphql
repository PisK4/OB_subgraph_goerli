type ChallengeInfoUpdated @entity(immutable: true) {
  id: Bytes!
  challengeId: Bytes! # bytes32
  challengeInfo_sourceTxFrom: BigInt! # uint256
  challengeInfo_sourceTxTime: BigInt! # uint64
  challengeInfo_challenger: Bytes! # address
  challengeInfo_freezeToken: Bytes! # address
  challengeInfo_challengeUserRatio: BigInt! # uint64
  challengeInfo_freezeAmount0: BigInt! # uint256
  challengeInfo_freezeAmount1: BigInt! # uint256
  challengeInfo_challengeTime: BigInt! # uint64
  challengeInfo_abortTime: BigInt! # uint64
  challengeInfo_verifiedTime0: BigInt! # uint64
  challengeInfo_verifiedTime1: BigInt! # uint64
  challengeInfo_verifiedDataHash0: Bytes! # bytes32
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}
type ColumnArrayUpdated @entity(immutable: true) {
  id: Bytes!
  impl: Bytes! # address
  columnArrayHash: Bytes! # bytes32
  dealers: [Bytes!] # address[]
  ebcs: [Bytes!] # address[]
  chainIds: [BigInt!] # uint64[]
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type ResponseMakersUpdated @entity(immutable: true) {
  id: Bytes!
  impl: Bytes! # address
  responseMakers: [BigInt!] # uint256[]
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type RulesRootUpdated @entity(immutable: true) {
  id: Bytes!
  impl: Bytes! # address
  ebc: Bytes! # address
  rootWithVersion_root: Bytes! # bytes32
  rootWithVersion_version: BigInt! # uint32
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
  input: Bytes!
}

type SpvUpdated @entity(immutable: true) {
  id: Bytes!
  impl: Bytes! # address
  chainId: BigInt! # uint64
  spv: Bytes! # address
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type MDCCreated @entity(immutable: true) {
  id: Bytes!
  maker: Bytes! # address
  mdc: Bytes! # address
  blockNumber: BigInt!
  blockTimestamp: BigInt!
}


type MDC @entity {
  id: ID!
  owner: Bytes! # address
  columnArrayHash: Bytes # bytes32
  responseMakers: [Bytes!] # address[]
  root: Bytes # bytes32
  version: Int # uint32
  spvs: [Bytes!] # address[]
  chainIds: [BigInt!] # uint64[]
  dealers: [Bytes!] # address[]
  ebc: [EBC!]! # EBC
  bindEBC: [MDCBindEBC!]! # MDCBindEBC
  # factory: FactoryManger 
  factory: [FactoryManger!]! @derivedFrom(field: "mdcs") 
  createblockNumber: BigInt!
  createblockTimestamp: BigInt!
  createtransactionHash: Bytes!
  lastestUpdatetransactionHash: Bytes!

}

type FactoryManger @entity{
  id: Bytes!  # factory address
  mdcs: [MDC!]! # MDC[]
  mdcCounts: BigInt!
  lastestUpdateHash: Bytes!
  lastestUpdateTimestamp: BigInt!
  lastestUpdateBlockNumber: BigInt!
}

type EBCManager @entity{
  id: ID! 
  # ebcs: [EBC!]! # MDC[]
  ebcCounts: BigInt!
  ebcs: [EBC!]! # ebc entity

  lastestUpdateHash: Bytes!
  lastestUpdateTimestamp: BigInt!
  lastestUpdateBlockNumber: BigInt!
}

type MDCBindEBC @entity{
  id: ID! # mdc address - ebc address
  root: Bytes # bytes32
  version: Int # uint32
  rule: [ruleTypes!] # latest 30 ruleTypes
  mdc: MDC! @derivedFrom(field: "bindEBC") # MDC
  lastestUpdateHash: Bytes!
  lastestUpdateTimestamp: BigInt!
  lastestUpdateBlockNumber: BigInt!
}

type EBC @entity {
  id: ID! #ebc address
  mdcList: [MDC!]! # list all mdc!! who bind this ebc
  ebcManager: EBCManager! @derivedFrom(field: "ebcs") # ebcManager entity
  # rule: [ruleTypes!] # latest 30 ruleTypes
  # root: Bytes # bytes32
  # version: Int # uint32
  # sourceChainIds: [BigInt!] # uint64
  # pledgeAmounts: [BigInt!] # uint128
  # token: Bytes # address
  # mdcs: [MDC!]!@derivedFrom(field: "ebc") # MDC[]
  lastestUpdatetransactionHash: Bytes!
}

type ruleTypes @entity {
  id: ID!
  chain0: BigInt! # uint64
  chain1: BigInt! # uint64
  chain0Status: Int! # uint8
  chain1Status: Int! # uint8
  chain0Token: BigInt! # uint
  chain1Token: BigInt! # uint
  minPrice: BigInt! # uint128
  maxPrice: BigInt! # uint128
  chain0WithholdingFee: BigInt! # uint128
  chain1WithholdingFee: BigInt! # uint128
  chain0TradeFee: Int! # uint16
  chain1TradeFee: Int! # uint16
  chain0ResponseTime: Int! # uint32
  chain1ResponseTime: Int! # uint32
  chain0CompensationRatio: Int! # uint32
  chain1CompensationRatio: Int! # uint32
}
